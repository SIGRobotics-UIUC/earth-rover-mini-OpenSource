# 06-4 音视频数据获取

**机器提供HTTP API 来开启RTSP-Server 为客户端提供实时流媒体**

**基础信息**

- 接口域名：`http(s)://192.168.11.1/rtsp`
- 请求方式：POST
- 数据格式：JSON
- 认证方式：账户密码（HTTP Basic Auth）

## 1 开启RTSP流

> 接口URL

```shell
/start
```

**请求参数**

| 参数名     | 类型   | 是否必填 | 描述                 |
| ---------- | ------ | -------- | -------------------- |
| stream_id  | String | 是       | 流 ID，唯一标识      |
| resolution | String | 否       | 分辨率（如 "1080p"） |
| framerate  | Int    | 否       | 帧率（默认 25）      |
| bitrate    | Int    | 否       | 码率（Kbps）         |

**请求示例**

```shell
curl -X POST \
  -u "username:password" \
  -H "Content-Type: application/json" \
  -d '{
    "stream_id": "camera001",
    "resolution": "720p",
    "framerate": 30,
    "bitrate": 2000
  }' \
  https://192.168.11.1/rtsp/start
```

**返回参数**

| 参数名    | 类型   | 描述                 |
| --------- | ------ | -------------------- |
| code      | Int    | 状态码（200 成功）   |
| message   | String | 提示信息             |
| rtsp_url  | String | RTSP 流地址          |
| expire_at | String | 流有效期（ISO 格式） |

**返回示例（成功）**

```json
{
  "code": 200,
  "message": "RTSP stream started successfully",
  "rtsp_url": "rtsp://192.168.11.1:554/camera001",
  "expire_at": "2025-06-24T12:00:00Z"
}
```

**返回示例（失败）**

```json
{
  "code": 401,
  "message": "Authentication failed"
}
```

## 2 关闭 RTSP 流

**接口 URL**

```plaintext
/stop
```

**请求参数**

| 参数名    | 类型   | 是否必填 | 描述          |
| --------- | ------ | -------- | ------------- |
| stream_id | String | 是       | 流 ID，需关闭 |

**请求示例**

```shell
curl -X POST \
  -u "username:password" \
  -H "Content-Type: application/json" \
  -d '{
    "stream_id": "camera001"
  }' \
  https://api.example.com/rtsp/stop
```

**返回参数**

| 参数名  | 类型   | 描述               |
| ------- | ------ | ------------------ |
| code    | Int    | 状态码（200 成功） |
| message | String | 提示信息           |

**返回示例（成功）**

```json
{
  "code": 200,
  "message": "RTSP stream stopped successfully"
}
```

## 3 错误码说明

| 错误码 | 描述                  | 原因                        |
| ------ | --------------------- | --------------------------- |
| 400    | Bad Request           | 参数格式错误                |
| 401    | Unauthorized          | 认证失败（账户 / 密码错误） |
| 403    | Forbidden             | 权限不足                    |
| 404    | Not Found             | 流 ID 不存在                |
| 500    | Internal Server Error | 服务器内部错误              |

## 4 认证说明

- **方式**：HTTP Basic Authentication
- **示例**：在请求头中添加 `Authorization: Basic base64(username:password)`
- **生成工具**：可使用在线 Base64 编码工具生成认证头